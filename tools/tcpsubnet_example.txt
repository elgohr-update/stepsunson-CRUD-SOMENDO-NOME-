Demonstrations of tcpsubnet, the Linux eBPF/bcc version.


tcpsubnet summarizes throughput by destination subnet.
It works only for IPv4. Eg:

# tcpsubnet
Tracing... Output every 1 secs. Hit Ctrl-C to end
[03/05/18 22:32:47]
127.0.0.1/32               8
[03/05/18 22:32:48]
[03/05/18 22:32:49]
[03/05/18 22:32:50]
[03/05/18 22:32:51]
[03/05/18 22:32:52]
127.0.0.1/32              10
[03/05/18 22:32:53]

This example output shows the number of bytes sent to 127.0.0.1/32 (the
loopback interface). For demo purposes, I set netcat listening on port
8080, connected to it and sent the following payloads.

# nc 127.0.0.1 8080
1111111
111111111

The first line sends 7 digits plus the null character (8 bytes)
The second line sends 9 digits plus the null character (10 bytes)

Notice also, how tcpsubnet prints a header line with the current date
and time formatted in the current locale.

Try it yourself to get a feeling of how tcpsubnet works.

By default, tcpsubnet will categorize traffic in the following subnets:

- 127.0.0.1/32
- 10.0.0.0/8
- 172.16.0.0/12
- 192.168.0.0/16
- 0.0.0.0/0

The last subnet is a catch-all. In other words, anything that doesn't
match the first 4 defaults will be categorized under 0.0.0.0/0
You can change this default behavior by passing a comma separated list
of subnets. Let's say we would like to know how much traffic we
are sending to github.com. We first find out what IPs github.com resolves
to, Eg:

# dig +short github.com
192.30.253.112
192.30.253.113

With this information, we can come up with a reasonable range of IPs
to monitor, Eg:
 
# tcpsubnet.py 192.30.253.110/27,0.0.0.0/0
Tracing... Output every 1 secs. Hit Ctrl-C to end
[03/05/18 22:38:58]
0.0.0.0/0               5780
192.30.253.110/27       2205
[03/05/18 22:38:59]
0.0.0.0/0               2036
192.30.253.110/27       1183
[03/05/18 22:39:00]
[03/05/18 22:39:01]
192.30.253.110/27      12537

If we would like to be more accurate, we can use the two IPs returned
by dig, Eg:

# tcpsubnet 192.30.253.113/32,192.130.253.112/32,0.0.0.0/0
Tracing... Output every 1 secs. Hit Ctrl-C to end
[03/05/18 22:42:56]
0.0.0.0/0               1177
192.30.253.113/32        910
[03/05/18 22:42:57]
0.0.0.0/0              48704
192.30.253.113/32        892
[03/05/18 22:42:58]
192.30.253.113/32        891
0.0.0.0/0                858
[03/05/18 22:42:59]
0.0.0.0/0              11159
192.30.253.113/32        894
[03/05/18 22:43:00]
0.0.0.0/0              60601

NOTE: When used in production, it is expected that you will have full
information about your network topology. In which case you won't need
to approximate subnets nor need to put individual IP addresses like
we just did.